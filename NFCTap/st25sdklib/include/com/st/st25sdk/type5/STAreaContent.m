//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: st25sdk_ios/type5/STAreaContent.java
//

#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "com/st/st25sdk/STException.h"
#include "com/st/st25sdk/command/Iso15693Protocol.h"
#include "com/st/st25sdk/command/NdefType5Command.h"
#include "com/st/st25sdk/ndef/NDEFMsg.h"
#include "com/st/st25sdk/type5/CCFile.h"
#include "com/st/st25sdk/type5/STAreaContent.h"
#include "com/st/st25sdk/type5/STType5MultiAreaTag.h"
#include "java/lang/Exception.h"

@interface ComStSt25sdkType5STAreaContent () {
 @public
  ComStSt25sdkType5STType5MultiAreaTag *mTag_;
  jint mMemoryOffsetInBytes_;
  jint mAreaSizeInBytes_;
  ComStSt25sdkNdefNDEFMsg *mNdefMsg_;
  ComStSt25sdkCommandNdefType5Command *mNdefType5Command_;
  jint mOffset_;
  jboolean mCacheActivated_;
  jboolean mCacheInvalidated_;
  jint mCcfileLength_;
}

@end

J2OBJC_FIELD_SETTER(ComStSt25sdkType5STAreaContent, mTag_, ComStSt25sdkType5STType5MultiAreaTag *)
J2OBJC_FIELD_SETTER(ComStSt25sdkType5STAreaContent, mNdefMsg_, ComStSt25sdkNdefNDEFMsg *)
J2OBJC_FIELD_SETTER(ComStSt25sdkType5STAreaContent, mNdefType5Command_, ComStSt25sdkCommandNdefType5Command *)

@implementation ComStSt25sdkType5STAreaContent

- (instancetype)initWithComStSt25sdkType5STType5MultiAreaTag:(ComStSt25sdkType5STType5MultiAreaTag *)tag
                                                     withInt:(jint)memoryOffsetInBytes
                                                     withInt:(jint)areaSizeInBytes
                     withComStSt25sdkCommandNdefType5Command:(ComStSt25sdkCommandNdefType5Command *)ndefType5Command {
  ComStSt25sdkType5STAreaContent_initWithComStSt25sdkType5STType5MultiAreaTag_withInt_withInt_withComStSt25sdkCommandNdefType5Command_(self, tag, memoryOffsetInBytes, areaSizeInBytes, ndefType5Command);
  return self;
}

- (void)writeNdefMessageWithInt:(jint)ccOffsetInBlocks
    withComStSt25sdkNdefNDEFMsg:(ComStSt25sdkNdefNDEFMsg *)msg {
  [self writeNdefMessageWithInt:ccOffsetInBlocks withComStSt25sdkNdefNDEFMsg:msg withByte:ComStSt25sdkCommandIso15693Protocol_DEFAULT_FLAG withByteArray:[((ComStSt25sdkType5STType5MultiAreaTag *) nil_chk(mTag_)) getUid]];
}

- (void)writeNdefMessageWithComStSt25sdkNdefNDEFMsg:(ComStSt25sdkNdefNDEFMsg *)msg {
  jint tlSize = 2;
  jint terminatorTlvLength = 1;
  jint areaSizeInBytes = mAreaSizeInBytes_;
  jint expectedCCFileLength = [((ComStSt25sdkType5STType5MultiAreaTag *) nil_chk(mTag_)) getExpectedCCFileLength];
  jint ndefMsgLength;
  @try {
    ndefMsgLength = [((ComStSt25sdkNdefNDEFMsg *) nil_chk(msg)) getLength];
  }
  @catch (JavaLangException *e) {
    [e printStackTrace];
    @throw new_ComStSt25sdkSTException_initWithComStSt25sdkSTException_STExceptionCode_(JreLoadEnum(ComStSt25sdkSTException_STExceptionCode, INVALID_NDEF_DATA));
  }
  if (ndefMsgLength > (areaSizeInBytes - expectedCCFileLength - tlSize - terminatorTlvLength)) {
    @throw new_ComStSt25sdkSTException_initWithComStSt25sdkSTException_STExceptionCode_(JreLoadEnum(ComStSt25sdkSTException_STExceptionCode, NDEF_MESSAGE_TOO_BIG));
  }
  if (mCcfileLength_ != expectedCCFileLength) {
    jint ccfileLengthInBytes;
    IOSByteArray *buffer;
    if (areaSizeInBytes > 2040) {
      buffer = [IOSByteArray newArrayWithLength:8];
      *IOSByteArray_GetRef(buffer, 0) = ComStSt25sdkType5CCFile_CCFILE_LONG_IDENTIFIER;
      *IOSByteArray_GetRef(buffer, 2) = (jint) 0x00;
      *IOSByteArray_GetRef(buffer, 3) = (jbyte) (jint) 0x01;
      *IOSByteArray_GetRef(buffer, 4) = (jint) 0x00;
      *IOSByteArray_GetRef(buffer, 5) = (jint) 0x00;
      *IOSByteArray_GetRef(buffer, 6) = (jbyte) (JreRShift32(((areaSizeInBytes / ComStSt25sdkType5CCFile_CCFILE_DATA_AREA_SIZE_MULTIPLIER) & (jint) 0xFF00), 8));
      *IOSByteArray_GetRef(buffer, 7) = (jbyte) ((areaSizeInBytes / ComStSt25sdkType5CCFile_CCFILE_DATA_AREA_SIZE_MULTIPLIER) & (jint) 0xFF);
      ccfileLengthInBytes = 8;
    }
    else {
      buffer = [IOSByteArray newArrayWithLength:4];
      *IOSByteArray_GetRef(buffer, 0) = ComStSt25sdkType5CCFile_CCFILE_SHORT_IDENTIFIER;
      *IOSByteArray_GetRef(buffer, 2) = (jbyte) (areaSizeInBytes / ComStSt25sdkType5CCFile_CCFILE_DATA_AREA_SIZE_MULTIPLIER);
      *IOSByteArray_GetRef(buffer, 3) = (jbyte) (jint) 0x01;
      ccfileLengthInBytes = 4;
    }
    *IOSByteArray_GetRef(buffer, 1) = (jbyte) (jint) 0x40;
    [((ComStSt25sdkType5STType5MultiAreaTag *) nil_chk(mTag_)) writeBytesWithInt:mMemoryOffsetInBytes_ withByteArray:buffer];
    mCcfileLength_ = ccfileLengthInBytes;
  }
  [self writeNdefMessageWithInt:(jbyte) (mCcfileLength_ & (jint) 0xFF) / [((ComStSt25sdkType5STType5MultiAreaTag *) nil_chk(mTag_)) getBlockSizeInBytes] withComStSt25sdkNdefNDEFMsg:msg];
}

- (void)writeNdefMessageWithInt:(jint)ccOffsetInBlocks
    withComStSt25sdkNdefNDEFMsg:(ComStSt25sdkNdefNDEFMsg *)msg
                       withByte:(jbyte)flag
                  withByteArray:(IOSByteArray *)uid {
  jint offsetInBlocks = mMemoryOffsetInBytes_ / [((ComStSt25sdkType5STType5MultiAreaTag *) nil_chk(mTag_)) getBlockSizeInBytes] + ccOffsetInBlocks;
  [((ComStSt25sdkCommandNdefType5Command *) nil_chk(mNdefType5Command_)) writeNdefMessageWithInt:offsetInBlocks withComStSt25sdkNdefNDEFMsg:msg withByte:flag withByteArray:uid];
  mNdefMsg_ = [((ComStSt25sdkNdefNDEFMsg *) nil_chk(msg)) copy__];
  mCacheInvalidated_ = false;
}

- (ComStSt25sdkNdefNDEFMsg *)readNdefMessage {
  return [self readNdefMessageWithByte:ComStSt25sdkCommandIso15693Protocol_DEFAULT_FLAG withByteArray:[((ComStSt25sdkType5STType5MultiAreaTag *) nil_chk(mTag_)) getUid]];
}

- (ComStSt25sdkNdefNDEFMsg *)readNdefMessageWithByte:(jbyte)flag
                                       withByteArray:(IOSByteArray *)uid {
  if (![self isCacheActivated] || ![self isCacheValid]) {
    IOSByteArray *ccBlock = [((ComStSt25sdkType5STType5MultiAreaTag *) nil_chk(mTag_)) readBytesWithInt:mMemoryOffsetInBytes_ withInt:8];
    if (((IOSByteArray *) nil_chk(ccBlock))->size_ >= 8) {
      if (IOSByteArray_Get(ccBlock, 2) == 0) {
        mCcfileLength_ = 8;
      }
      else {
        mCcfileLength_ = 4;
      }
    }
    else {
      @throw new_ComStSt25sdkSTException_initWithComStSt25sdkSTException_STExceptionCode_(JreLoadEnum(ComStSt25sdkSTException_STExceptionCode, CMD_FAILED));
    }
    jint nbOfBlocksInCCFile = mCcfileLength_ / [((ComStSt25sdkType5STType5MultiAreaTag *) nil_chk(mTag_)) getBlockSizeInBytes];
    mNdefMsg_ = [self readNdefMessageWithInt:nbOfBlocksInCCFile withByte:flag withByteArray:uid];
    mCacheInvalidated_ = false;
  }
  if (mNdefMsg_ != nil) {
    return [mNdefMsg_ copy__];
  }
  else {
    return nil;
  }
}

- (ComStSt25sdkNdefNDEFMsg *)readNdefMessageWithInt:(jint)nbOfBlocksInCCFile
                                           withByte:(jbyte)flag
                                      withByteArray:(IOSByteArray *)uid {
  if ([self isCacheActivated] && [self isCacheValid]) {
    if (mNdefMsg_ != nil) {
      return [mNdefMsg_ copy__];
    }
    else {
      return nil;
    }
  }
  else {
    mNdefMsg_ = [((ComStSt25sdkCommandNdefType5Command *) nil_chk(mNdefType5Command_)) readNdefMessageWithInt:mMemoryOffsetInBytes_ / [((ComStSt25sdkType5STType5MultiAreaTag *) nil_chk(mTag_)) getBlockSizeInBytes] + nbOfBlocksInCCFile withByte:flag withByteArray:uid];
    mCacheInvalidated_ = false;
    if (mNdefMsg_ != nil) {
      return [mNdefMsg_ copy__];
    }
    else {
      return nil;
    }
  }
}

- (void)invalidateCache {
  mCacheInvalidated_ = true;
}

- (void)validateCache {
  mCacheInvalidated_ = false;
}

- (void)activateCache {
  mCacheActivated_ = true;
}

- (void)deactivateCache {
  mCacheActivated_ = false;
}

- (void)updateCache {
  mCacheInvalidated_ = true;
}

- (jboolean)isCacheValid {
  return !mCacheInvalidated_;
}

- (jboolean)isCacheActivated {
  return mCacheActivated_;
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 1, 2, 3, -1, -1, -1 },
    { NULL, "V", 0x1, 1, 4, 3, -1, -1, -1 },
    { NULL, "V", 0x1, 1, 5, 3, -1, -1, -1 },
    { NULL, "LComStSt25sdkNdefNDEFMsg;", 0x1, -1, -1, 3, -1, -1, -1 },
    { NULL, "LComStSt25sdkNdefNDEFMsg;", 0x1, 6, 7, 3, -1, -1, -1 },
    { NULL, "LComStSt25sdkNdefNDEFMsg;", 0x1, 6, 8, 3, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, 3, -1, -1, -1 },
    { NULL, "Z", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x1, -1, -1, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithComStSt25sdkType5STType5MultiAreaTag:withInt:withInt:withComStSt25sdkCommandNdefType5Command:);
  methods[1].selector = @selector(writeNdefMessageWithInt:withComStSt25sdkNdefNDEFMsg:);
  methods[2].selector = @selector(writeNdefMessageWithComStSt25sdkNdefNDEFMsg:);
  methods[3].selector = @selector(writeNdefMessageWithInt:withComStSt25sdkNdefNDEFMsg:withByte:withByteArray:);
  methods[4].selector = @selector(readNdefMessage);
  methods[5].selector = @selector(readNdefMessageWithByte:withByteArray:);
  methods[6].selector = @selector(readNdefMessageWithInt:withByte:withByteArray:);
  methods[7].selector = @selector(invalidateCache);
  methods[8].selector = @selector(validateCache);
  methods[9].selector = @selector(activateCache);
  methods[10].selector = @selector(deactivateCache);
  methods[11].selector = @selector(updateCache);
  methods[12].selector = @selector(isCacheValid);
  methods[13].selector = @selector(isCacheActivated);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "mTag_", "LComStSt25sdkType5STType5MultiAreaTag;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "mMemoryOffsetInBytes_", "I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "mAreaSizeInBytes_", "I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "mNdefMsg_", "LComStSt25sdkNdefNDEFMsg;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "mNdefType5Command_", "LComStSt25sdkCommandNdefType5Command;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "mOffset_", "I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "mCacheActivated_", "Z", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "mCacheInvalidated_", "Z", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "mCcfileLength_", "I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LComStSt25sdkType5STType5MultiAreaTag;IILComStSt25sdkCommandNdefType5Command;", "writeNdefMessage", "ILComStSt25sdkNdefNDEFMsg;", "LComStSt25sdkSTException;", "LComStSt25sdkNdefNDEFMsg;", "ILComStSt25sdkNdefNDEFMsg;B[B", "readNdefMessage", "B[B", "IB[B" };
  static const J2ObjcClassInfo _ComStSt25sdkType5STAreaContent = { "STAreaContent", "com.st.st25sdk.type5", ptrTable, methods, fields, 7, 0x1, 14, 9, -1, -1, -1, -1, -1 };
  return &_ComStSt25sdkType5STAreaContent;
}

@end

void ComStSt25sdkType5STAreaContent_initWithComStSt25sdkType5STType5MultiAreaTag_withInt_withInt_withComStSt25sdkCommandNdefType5Command_(ComStSt25sdkType5STAreaContent *self, ComStSt25sdkType5STType5MultiAreaTag *tag, jint memoryOffsetInBytes, jint areaSizeInBytes, ComStSt25sdkCommandNdefType5Command *ndefType5Command) {
  NSObject_init(self);
  self->mNdefMsg_ = nil;
  self->mTag_ = tag;
  self->mMemoryOffsetInBytes_ = memoryOffsetInBytes;
  self->mAreaSizeInBytes_ = areaSizeInBytes;
  self->mNdefType5Command_ = ndefType5Command;
  self->mCacheActivated_ = true;
  self->mCacheInvalidated_ = true;
}

ComStSt25sdkType5STAreaContent *new_ComStSt25sdkType5STAreaContent_initWithComStSt25sdkType5STType5MultiAreaTag_withInt_withInt_withComStSt25sdkCommandNdefType5Command_(ComStSt25sdkType5STType5MultiAreaTag *tag, jint memoryOffsetInBytes, jint areaSizeInBytes, ComStSt25sdkCommandNdefType5Command *ndefType5Command) {
  J2OBJC_NEW_IMPL(ComStSt25sdkType5STAreaContent, initWithComStSt25sdkType5STType5MultiAreaTag_withInt_withInt_withComStSt25sdkCommandNdefType5Command_, tag, memoryOffsetInBytes, areaSizeInBytes, ndefType5Command)
}

ComStSt25sdkType5STAreaContent *create_ComStSt25sdkType5STAreaContent_initWithComStSt25sdkType5STType5MultiAreaTag_withInt_withInt_withComStSt25sdkCommandNdefType5Command_(ComStSt25sdkType5STType5MultiAreaTag *tag, jint memoryOffsetInBytes, jint areaSizeInBytes, ComStSt25sdkCommandNdefType5Command *ndefType5Command) {
  J2OBJC_CREATE_IMPL(ComStSt25sdkType5STAreaContent, initWithComStSt25sdkType5STType5MultiAreaTag_withInt_withInt_withComStSt25sdkCommandNdefType5Command_, tag, memoryOffsetInBytes, areaSizeInBytes, ndefType5Command)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ComStSt25sdkType5STAreaContent)
